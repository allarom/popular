{"ast":null,"code":"var __jsx = React.createElement;\nimport React, { useEffect, useState, useRef } from 'react';\nimport dynamic from 'next/dynamic'; // import { select, hierarchy, tree, linkVertical, forceSimulation, forceCenter,  mouse,  forceX,  forceY, forceCollide, forceRadial, scaleSqrt} from \"d3\"\n// import * as d3 from 'd3'\n\nimport json from './lang';\nimport { forceManyBody, force } from 'd3-force';\nimport useResizeObserver from '../hooks/useResizeObeserver';\n\nvar Page = function Page(props) {\n  var svgRef = useRef();\n  var wrapperRef = useRef();\n  var dimensions = useResizeObserver(wrapperRef);\n  useEffect(function () {\n    if (!dimensions) return; // const svg = select(svgRef.current)\n\n    var width = dimensions.width,\n        height = dimensions.height,\n        root;\n    var getRadius = d3.scale.log().domain([10000, 2600000000000]).range([5, 50]);\n\n    function linkDistance(d) {\n      return getRadius(d.source.speaker) * 2;\n    }\n\n    var force = d3.layout.force().linkDistance(linkDistance).charge(-120).gravity(.05).size([width, height]).on(\"tick\", tick); // var svg = d3.select(\"body\").append(\"svg\")\n    //     .attr(\"width\", width)\n    //     .attr(\"height\", height);\n\n    var svg = d3.select(svgRef.current);\n    var link = svg.selectAll(\".link\"),\n        node = svg.selectAll(\".node\");\n    root = json;\n    update();\n\n    function update() {\n      var nodes = flatten(root),\n          links = d3.layout.tree().links(nodes); // Restart the force layout.\n\n      force.nodes(nodes).links(links).start(); // Update links.\n\n      link = link.data(links, function (d) {\n        return d.target.id;\n      });\n      link.exit().remove();\n      link.enter().insert(\"line\", \".node\").attr(\"class\", \"link\"); // Update nodes.\n\n      node = node.data(nodes, function (d) {\n        return d.id;\n      });\n      node.exit().remove();\n      var nodeEnter = node.enter().append(\"g\").attr(\"class\", \"node\").on(\"click\", click).call(force.drag);\n      var radiusScale = d3.scale.log().domain([10000, 2600000000000]).range([5, 50]);\n      nodeEnter.append(\"circle\").attr(\"r\", function (node) {\n        // getLink(node.speaker)\n        var scale = radiusScale(node.speaker);\n        return scale;\n      });\n      nodeEnter.append(\"text\").attr(\"dy\", \"30px\").text(function (d) {\n        return d.language;\n      }); // .attr(\"y\", node => node.y + \"10px\")\n\n      node.select(\"circle\").style(\"fill\", color);\n    }\n\n    function tick() {\n      link.attr(\"x1\", function (d) {\n        return d.source.x;\n      }).attr(\"y1\", function (d) {\n        return d.source.y;\n      }).attr(\"x2\", function (d) {\n        return d.target.x;\n      }).attr(\"y2\", function (d) {\n        return d.target.y;\n      });\n      node.attr(\"transform\", function (d) {\n        return \"translate(\" + d.x + \",\" + d.y + \")\";\n      });\n    }\n\n    function color(d) {\n      return d._children ? \"#3182bd\" // collapsed package\n      : d.children ? \"#c6dbef\" // expanded package\n      : \"#fd8d3c\"; // leaf node\n    } // Toggle children on click.\n\n\n    function click(d) {\n      if (d3.event.defaultPrevented) return; // ignore drag\n\n      if (d.children) {\n        d._children = d.children;\n        d.children = null;\n      } else {\n        d.children = d._children;\n        d._children = null;\n      }\n\n      update();\n    } // Returns a list of all nodes under the root.\n\n\n    function flatten(root) {\n      var nodes = [],\n          i = 0;\n\n      function recurse(node) {\n        if (node.children) node.children.forEach(recurse);\n        if (!node.id) node.id = ++i;\n        nodes.push(node);\n      }\n\n      recurse(root);\n      return nodes;\n    } // const simulation = forceSimulation(nodeData)\n    // // force\n    // .force(\"center\", forceCenter(dimensions.width/2, dimensions.height/2))\n    // .force(\"charge\", forceManyBody().strength(-40))\n    // .force(\"collide\", forceCollide(60))\n    // .on(\"tick\", () => {\n    //   const linkGenerator = linkVertical()\n    //   .x(node => node.x)\n    //   .y(node => node.y + 100)\n    //   svg\n    //   .selectAll(\".node\")\n    //   .data(nodeData)\n    //   .join(\"circle\")\n    //   .attr(\"class\", \"node\")\n    //   .attr(\"r\", 5)\n    //   .attr(\"fill\", \"grey\")\n    //   .attr(\"cx\", node => node.x)\n    //   .attr(\"cy\", node => node.y + 100)\n    //   svg\n    //   .selectAll(\".link\")\n    //   .data(linkData)\n    //   .join(\"path\").attr(\"class\",\"link\")\n    //   .attr(\"fill\", \"none\")\n    //   .attr(\"stroke\", \"grey\")\n    //   .attr(\"d\", linkGenerator)\n    //   .attr(\"x1\", link => link.source.x)\n    //   .attr(\"y1\", link => link.source.y)\n    //   .attr(\"x2\", link => link.target.x)\n    //   .attr(\"y2\", link => link.target.y)\n    //   svg\n    //   .selectAll(\".label\")\n    //   .data(root.descendants())\n    //   .join(\"text\")\n    //   .attr(\"class\", \"label\")\n    //   .attr(\"fill\", \"black\")\n    //   .text(node => node.data.language)\n    //   .attr(\"font-size\", 16)\n    //   .attr(\"text-anchor\", \"middle\")\n    //   .attr(\"x\", node => node.x)\n    //   .attr(\"y\", node => node.y + 85)\n    // })\n    // svg.on(\"mousemove\", ()=> {\n    //   const [x,y] = mouse(svgRef.current)\n    //   simulation\n    //   .force(\"x\", forceX(x).strength(node => 0.2 + node.depth * 0.15))\n    //   .force(\"y\", forceY(y).strength(node => 0.2 + node.depth * 0.15))\n    // })\n    // svg.on(\"click\", () => {\n    //    const [x, y] = mouse(svgRef.current)\n    //    simulation\n    //    .alpha(0.5)\n    //    .restart()\n    //    .force(\"orbit\", forceRadial(100, x, y))\n    //    svg.selectAll(\".orbit\")\n    //    .data([json])\n    //    .join(\"circle\")\n    //    .attr(\"class\", \"orbit\")\n    //    .attr(\"fill\", \"none\")\n    //    .attr(\"r\", 500)\n    //    .attr(\"cx\", x)\n    //    .attr(\"cy\", y)\n    // })\n\n  }, [json, dimensions]);\n  return __jsx(React.Fragment, null, __jsx(\"div\", {\n    ref: wrapperRef\n  }, __jsx(\"svg\", {\n    ref: svgRef,\n    height: \"100vh\"\n  })), __jsx(\"br\", null));\n};\n\nexport default Page;","map":null,"metadata":{},"sourceType":"module"}